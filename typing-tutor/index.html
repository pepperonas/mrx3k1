<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10-Finger-Tipp-Trainer</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --secondary: #166088;
            --accent: #48a9a6;
            --light: #e4dfda;
            --dark: #1e1e24;
            --success: #4caf50;
            --error: #f44336;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .container {
            width: 900px;
            max-width: 95%;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 20px;
            position: relative;
        }

        header {
            text-align: center;
            padding: 15px 0;
            margin-bottom: 20px;
            color: var(--secondary);
            border-bottom: 2px solid var(--light);
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .stat {
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            background-color: var(--light);
            min-width: 120px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--secondary);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }

        .text-display {
            background-color: #f9f9f9;
            border-radius: 5px;
            padding: 20px;
            font-size: 24px;
            line-height: 1.6;
            margin-bottom: 20px;
            height: 120px;
            overflow: hidden;
            position: relative;
        }

        .current-text {
            position: relative;
            letter-spacing: 1px;
        }

        .current-character {
            background-color: var(--accent);
            color: white;
            animation: pulse 1s infinite;
        }

        .correct-character {
            color: var(--success);
        }

        .incorrect-character {
            color: var(--error);
            text-decoration: underline;
        }

        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 30px;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 5px;
        }

        .key {
            width: 50px;
            height: 50px;
            background-color: #f9f9f9;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 3px 0 rgba(0, 0, 0, 0.1);
            cursor: default;
            position: relative;
            transition: all 0.1s;
        }

        .key-wide {
            width: 100px;
        }

        .key-extra-wide {
            width: 200px;
        }

        .key-active {
            background-color: var(--accent);
            color: white;
            transform: translateY(2px);
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1);
        }

        .key-highlight {
            background-color: var(--primary);
            color: white;
            animation: pulse 1s infinite;
        }

        .finger-hint {
            position: absolute;
            bottom: 5px;
            left: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .finger-1 {
            background-color: #FF5252;
        }

        /* Kleiner Finger links */
        .finger-2 {
            background-color: #FF9800;
        }

        /* Ringfinger links */
        .finger-3 {
            background-color: #FFEB3B;
        }

        /* Mittelfinger links */
        .finger-4 {
            background-color: #4CAF50;
        }

        /* Zeigefinger links */
        .finger-5 {
            background-color: #2196F3;
        }

        /* Daumen */
        .finger-6 {
            background-color: #4CAF50;
        }

        /* Zeigefinger rechts */
        .finger-7 {
            background-color: #FFEB3B;
        }

        /* Mittelfinger rechts */
        .finger-8 {
            background-color: #FF9800;
        }

        /* Ringfinger rechts */
        .finger-9 {
            background-color: #FF5252;
        }

        /* Kleiner Finger rechts */

        .hand-diagram {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 720px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s;
            display: none;
        }

        .hand-diagram img {
            width: 100%;
        }

        .level-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
        }

        .progress-container {
            width: 100%;
            height: 10px;
            background-color: var(--light);
            border-radius: 5px;
            margin-top: 10px;
        }

        .progress-bar {
            height: 100%;
            border-radius: 5px;
            background-color: var(--accent);
            width: 0%;
            transition: width 0.5s;
        }

        .level-complete {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .level-complete.active {
            opacity: 1;
            pointer-events: all;
        }

        .level-complete h2 {
            font-size: 36px;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        .stats-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .level-stat {
            text-align: center;
            font-size: 18px;
        }

        .level-stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
        }

        .next-level-btn {
            padding: 10px 20px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .next-level-btn:hover {
            background-color: var(--primary);
            transform: scale(1.05);
        }

        .restart-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: var(--light);
            color: var(--dark);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .restart-btn:hover {
            background-color: var(--dark);
            color: var(--light);
        }

        .help-btn {
            position: absolute;
            top: 20px;
            left: 100px;
            background-color: var(--light);
            color: var(--dark);
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .help-btn:hover {
            background-color: var(--dark);
            color: var(--light);
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                opacity: 1;
            }
        }

        /* Animationen für Game-Elemente */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        .game-element {
            animation: fadeInUp 0.5s ease-out;
        }

        .bounce {
            animation: bounce 0.5s;
        }

        /* Konfetti Animation für Level-Up */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(500px) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>10-Finger-Tipp-Trainer</h1>
    </header>

    <button class="restart-btn">Neustart</button>
    <button class="help-btn">Hilfe</button>
    <div class="level-indicator">Level <span id="current-level">1</span></div>

    <div class="game-stats">
        <div class="stat game-element">
            <div class="stat-label">ZEIT</div>
            <div class="stat-value" id="time">00:00</div>
        </div>
        <div class="stat game-element">
            <div class="stat-label">WPM</div>
            <div class="stat-value" id="wpm">0</div>
        </div>
        <div class="stat game-element">
            <div class="stat-label">GENAUIGKEIT</div>
            <div class="stat-value" id="accuracy">100%</div>
        </div>
    </div>

    <div class="text-display game-element">
        <div class="current-text" id="text-display"></div>
    </div>

    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div class="keyboard game-element">
        <div class="keyboard-row">
            <div class="key" data-key="^" data-finger="1"><span>^</span>
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="1" data-finger="1">1
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="2" data-finger="2">2
                <div class="finger-hint finger-2"></div>
            </div>
            <div class="key" data-key="3" data-finger="3">3
                <div class="finger-hint finger-3"></div>
            </div>
            <div class="key" data-key="4" data-finger="4">4
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="5" data-finger="4">5
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="6" data-finger="6">6
                <div class="finger-hint finger-6"></div>
            </div>
            <div class="key" data-key="7" data-finger="6">7
                <div class="finger-hint finger-6"></div>
            </div>
            <div class="key" data-key="8" data-finger="7">8
                <div class="finger-hint finger-7"></div>
            </div>
            <div class="key" data-key="9" data-finger="8">9
                <div class="finger-hint finger-8"></div>
            </div>
            <div class="key" data-key="0" data-finger="9">0
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key" data-key="ß" data-finger="9">ß
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key" data-key="´" data-finger="9">´
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key key-wide" data-key="Backspace" data-finger="9">⌫
                <div class="finger-hint finger-9"></div>
            </div>
        </div>
        <div class="keyboard-row">
            <div class="key key-wide" data-key="Tab" data-finger="1">Tab
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="q" data-finger="1">Q
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="w" data-finger="2">W
                <div class="finger-hint finger-2"></div>
            </div>
            <div class="key" data-key="e" data-finger="3">E
                <div class="finger-hint finger-3"></div>
            </div>
            <div class="key" data-key="r" data-finger="4">R
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="t" data-finger="4">T
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="z" data-finger="6">Z
                <div class="finger-hint finger-6"></div>
            </div>
            <div class="key" data-key="u" data-finger="6">U
                <div class="finger-hint finger-6"></div>
            </div>
            <div class="key" data-key="i" data-finger="7">I
                <div class="finger-hint finger-7"></div>
            </div>
            <div class="key" data-key="o" data-finger="8">O
                <div class="finger-hint finger-8"></div>
            </div>
            <div class="key" data-key="p" data-finger="9">P
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key" data-key="ü" data-finger="9">Ü
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key" data-key="+" data-finger="9">+
                <div class="finger-hint finger-9"></div>
            </div>
        </div>
        <div class="keyboard-row">
            <div class="key key-wide" data-key="CapsLock" data-finger="1">Caps
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="a" data-finger="1">A
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="s" data-finger="2">S
                <div class="finger-hint finger-2"></div>
            </div>
            <div class="key" data-key="d" data-finger="3">D
                <div class="finger-hint finger-3"></div>
            </div>
            <div class="key" data-key="f" data-finger="4">F
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="g" data-finger="4">G
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="h" data-finger="6">H
                <div class="finger-hint finger-6"></div>
            </div>
            <div class="key" data-key="j" data-finger="6">J
                <div class="finger-hint finger-6"></div>
            </div>
            <div class="key" data-key="k" data-finger="7">K
                <div class="finger-hint finger-7"></div>
            </div>
            <div class="key" data-key="l" data-finger="8">L
                <div class="finger-hint finger-8"></div>
            </div>
            <div class="key" data-key="ö" data-finger="9">Ö
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key" data-key="ä" data-finger="9">Ä
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key" data-key="#" data-finger="9">#
                <div class="finger-hint finger-9"></div>
            </div>
        </div>
        <div class="keyboard-row">
            <div class="key key-wide" data-key="Shift" data-finger="1">Shift
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="<" data-finger="1"><
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="y" data-finger="2">Y
                <div class="finger-hint finger-2"></div>
            </div>
            <div class="key" data-key="x" data-finger="3">X
                <div class="finger-hint finger-3"></div>
            </div>
            <div class="key" data-key="c" data-finger="4">C
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="v" data-finger="4">V
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="b" data-finger="4">B
                <div class="finger-hint finger-4"></div>
            </div>
            <div class="key" data-key="n" data-finger="6">N
                <div class="finger-hint finger-6"></div>
            </div>
            <div class="key" data-key="m" data-finger="6">M
                <div class="finger-hint finger-6"></div>
            </div>
            <div class="key" data-key="," data-finger="7">,
                <div class="finger-hint finger-7"></div>
            </div>
            <div class="key" data-key="." data-finger="8">.
                <div class="finger-hint finger-8"></div>
            </div>
            <div class="key" data-key="-" data-finger="9">-
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key key-wide" data-key="Shift" data-finger="9">Shift
                <div class="finger-hint finger-9"></div>
            </div>
        </div>
        <div class="keyboard-row">
            <div class="key" data-key="Control" data-finger="1">Ctrl
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key" data-key="Alt" data-finger="1">Alt
                <div class="finger-hint finger-1"></div>
            </div>
            <div class="key key-extra-wide" data-key=" " data-finger="5">Leertaste
                <div class="finger-hint finger-5"></div>
            </div>
            <div class="key" data-key="Alt" data-finger="9">Alt
                <div class="finger-hint finger-9"></div>
            </div>
            <div class="key" data-key="Control" data-finger="9">Ctrl
                <div class="finger-hint finger-9"></div>
            </div>
        </div>
    </div>

    <div class="hand-diagram">
        <img src="docs/finger-position.png" alt="Handhaltung"/>
        <p>Halte deine Finger auf der Tastatur wie gezeigt, um alle Tasten effizient zu
            erreichen.</p>
    </div>

    <div class="level-complete">
        <h2>Level Abgeschlossen!</h2>
        <div class="stats-container">
            <div class="level-stat">
                <div class="level-stat-value" id="level-wpm">0</div>
                <div>WPM</div>
            </div>
            <div class="level-stat">
                <div class="level-stat-value" id="level-accuracy">100%</div>
                <div>Genauigkeit</div>
            </div>
            <div class="level-stat">
                <div class="level-stat-value" id="level-time">00:00</div>
                <div>Zeit</div>
            </div>
        </div>
        <button class="next-level-btn">Nächstes Level</button>
    </div>
</div>

<script>
    // Spielkonstanten und -variablen
    const levels = [
        {
            name: "Grundlage - Mittelreihe",
            text: "asdf jklö asdf jklö asdf jklö asdf jklö fjdk slöa asdfjklö fdsa ölkj",
            focusKeys: ["a", "s", "d", "f", "j", "k", "l", "ö"]
        },
        {
            name: "Grundlage - Obere Reihe",
            text: "qwer uiop qwer uiop qwer uiop qwert zuiop qwer tzui",
            focusKeys: ["q", "w", "e", "r", "t", "z", "u", "i", "o", "p"]
        },
        {
            name: "Grundlage - Untere Reihe",
            text: "yxcv bnm yxcv bnm yxcv bnm yxcvb nm",
            focusKeys: ["y", "x", "c", "v", "b", "n", "m"]
        },
        {
            name: "Kombination - Alle Buchstaben",
            text: "der schnelle braune fuchs springt über den faulen hund maja und willi fliegen durch den wald",
            focusKeys: []
        },
        {
            name: "Fortgeschritten - Mit Umlauten",
            text: "schöne grüße aus köln wir üben jetzt mit umlauten ä ö ü",
            focusKeys: ["ä", "ö", "ü"]
        },
        {
            name: "Fortgeschritten - Satzzeichen",
            text: "Hallo, wie geht es dir? Mir geht es gut! Das ist ein Test; bitte übe weiter.",
            focusKeys: [",", ".", "?", "!"]
        },
        {
            name: "Experte - Komplexe Sätze",
            text: "Der Fluss floss träge durch das Tal. Die Bäume am Ufer spiegelten sich im Wasser. Ein Boot glitt langsam vorbei.",
            focusKeys: []
        },
        {
            name: "Meister - Schnelligkeit",
            text: "schnell tippen ist eine kunst die übung erfordert je mehr du übst desto besser wirst du werden",
            focusKeys: []
        }
    ];

    let currentLevel = 0;
    let currentTextIndex = 0;
    let correctCharacters = 0;
    let incorrectCharacters = 0;
    let startTime = null;
    let timerInterval = null;
    let totalSeconds = 0;
    let isGameActive = false;

    // DOM-Elemente
    const textDisplay = document.getElementById('text-display');
    const timeDisplay = document.getElementById('time');
    const wpmDisplay = document.getElementById('wpm');
    const accuracyDisplay = document.getElementById('accuracy');
    const progressBar = document.getElementById('progress-bar');
    const currentLevelDisplay = document.getElementById('current-level');
    const levelCompleteScreen = document.querySelector('.level-complete');
    const nextLevelBtn = document.querySelector('.next-level-btn');
    const restartBtn = document.querySelector('.restart-btn');
    const helpBtn = document.querySelector('.help-btn');
    const handDiagram = document.querySelector('.hand-diagram');
    const levelWpm = document.getElementById('level-wpm');
    const levelAccuracy = document.getElementById('level-accuracy');
    const levelTime = document.getElementById('level-time');

    // Level-Setup
    function setupLevel() {
        currentTextIndex = 0;
        correctCharacters = 0;
        incorrectCharacters = 0;
        totalSeconds = 0;
        isGameActive = false;

        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        timeDisplay.textContent = '00:00';
        wpmDisplay.textContent = '0';
        accuracyDisplay.textContent = '100%';
        progressBar.style.width = '0%';

        currentLevelDisplay.textContent = currentLevel + 1;

        // Text anzeigen
        const levelText = levels[currentLevel].text;
        textDisplay.innerHTML = '';

        for (let i = 0; i < levelText.length; i++) {
            const charSpan = document.createElement('span');
            charSpan.textContent = levelText[i];
            if (i === 0) {
                charSpan.classList.add('current-character');
            }
            textDisplay.appendChild(charSpan);
        }

        // Tastatur-Fokus setzen
        highlightKeys();
    }

    // Timer-Funktion
    function startTimer() {
        startTime = new Date();
        if (timerInterval) clearInterval(timerInterval);

        timerInterval = setInterval(() => {
            const currentTime = new Date();
            totalSeconds = Math.floor((currentTime - startTime) / 1000);

            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;

            timeDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // WPM aktualisieren
            updateWPM();
        }, 1000);
    }

    // WPM berechnen
    function updateWPM() {
        if (totalSeconds === 0) return;

        // WPM Berechnung (Anzahl der Zeichen / 5 / Minuten)
        const minutes = totalSeconds / 60;
        const wpm = Math.round((correctCharacters / 5) / minutes);

        wpmDisplay.textContent = wpm;
    }

    // Genauigkeit berechnen
    function updateAccuracy() {
        const totalAttempts = correctCharacters + incorrectCharacters;
        if (totalAttempts === 0) return;

        const accuracy = Math.round((correctCharacters / totalAttempts) * 100);
        accuracyDisplay.textContent = `${accuracy}%`;
    }

    // Fortschritt aktualisieren
    function updateProgress() {
        const levelText = levels[currentLevel].text;
        const progress = (currentTextIndex / levelText.length) * 100;
        progressBar.style.width = `${progress}%`;

        // Level abgeschlossen?
        if (currentTextIndex >= levelText.length) {
            completeLevel();
        }
    }

    // Level abschließen
    function completeLevel() {
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }

        isGameActive = false;

        // Statistiken für Level-Abschluss-Bildschirm
        levelWpm.textContent = wpmDisplay.textContent;
        levelAccuracy.textContent = accuracyDisplay.textContent;
        levelTime.textContent = timeDisplay.textContent;

        // Level-Abschluss-Bildschirm anzeigen
        levelCompleteScreen.classList.add('active');

        // Konfetti-Animation
        createConfetti();
    }

    // Konfetti erstellen
    function createConfetti() {
        const confettiCount = 100;
        const container = document.querySelector('.container');

        for (let i = 0; i < confettiCount; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');

            // Zufällige Position
            const leftPos = Math.random() * 100;
            confetti.style.left = `${leftPos}%`;

            // Zufällige Farbe
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.backgroundColor = color;

            // Zufällige Größe
            const size = Math.random() * 10 + 5;
            confetti.style.width = `${size}px`;
            confetti.style.height = `${size}px`;

            // Animation
            const duration = Math.random() * 3 + 2;
            const delay = Math.random() * 2;
            confetti.style.animation = `confetti-fall ${duration}s ${delay}s linear forwards`;

            container.appendChild(confetti);

            // Nach Animation entfernen
            setTimeout(() => {
                confetti.remove();
            }, (duration + delay) * 1000);
        }
    }

    // Tasten hervorheben
    function highlightKeys() {
        // Alle Hervorhebungen zurücksetzen
        document.querySelectorAll('.key').forEach(key => {
            key.classList.remove('key-highlight');
        });

        // Aktuelle Taste hervorheben
        const levelText = levels[currentLevel].text;
        if (currentTextIndex < levelText.length) {
            const currentChar = levelText[currentTextIndex].toLowerCase();
            const keyElement = document.querySelector(`.key[data-key="${currentChar}"]`);
            if (keyElement) {
                keyElement.classList.add('key-highlight');
            }
        }

        // Fokus-Tasten für das Level hervorheben
        const focusKeys = levels[currentLevel].focusKeys;
        focusKeys.forEach(key => {
            const keyElement = document.querySelector(`.key[data-key="${key}"]`);
            if (keyElement) {
                keyElement.classList.add('key-highlight');
            }
        });
    }

    // Tastatur-Animation
    function animateKey(key) {
        const keyElement = document.querySelector(`.key[data-key="${key.toLowerCase()}"]`);
        if (keyElement) {
            keyElement.classList.add('key-active');
            setTimeout(() => {
                keyElement.classList.remove('key-active');
            }, 100);
        }
    }

    // Tastendruck verarbeiten
    function handleKeyPress(event) {
        // Nur verarbeiten, wenn kein Overlay angezeigt wird
        if (levelCompleteScreen.classList.contains('active')) return;

        const pressedKey = event.key;
        animateKey(pressedKey);

        // Spielstart
        if (!isGameActive) {
            isGameActive = true;
            startTimer();
        }

        // Aktuellen Zeichen prüfen
        const levelText = levels[currentLevel].text;
        if (currentTextIndex < levelText.length) {
            const currentChar = levelText[currentTextIndex];
            const currentCharElement = textDisplay.children[currentTextIndex];

            if (pressedKey === currentChar) {
                // Richtig
                currentCharElement.classList.remove('current-character');
                currentCharElement.classList.add('correct-character');
                correctCharacters++;

                // Nächster Zeichen
                currentTextIndex++;
                if (currentTextIndex < levelText.length) {
                    textDisplay.children[currentTextIndex].classList.add('current-character');
                }

                // Bounce-Animation an der Statistik
                wpmDisplay.parentElement.classList.add('bounce');
                setTimeout(() => {
                    wpmDisplay.parentElement.classList.remove('bounce');
                }, 500);
            } else {
                // Falsch
                currentCharElement.classList.add('incorrect-character');
                incorrectCharacters++;

                // Shake-Animation
                textDisplay.classList.add('bounce');
                setTimeout(() => {
                    textDisplay.classList.remove('bounce');
                }, 500);

                // Bounce-Animation an der Statistik
                accuracyDisplay.parentElement.classList.add('bounce');
                setTimeout(() => {
                    accuracyDisplay.parentElement.classList.remove('bounce');
                }, 500);
            }

            // Statistiken aktualisieren
            updateAccuracy();
            updateWPM();
            updateProgress();
            highlightKeys();
        }
    }

    // Nächstes Level
    function nextLevel() {
        currentLevel = (currentLevel + 1) % levels.length;
        levelCompleteScreen.classList.remove('active');
        setupLevel();
    }

    // Neustart
    function restart() {
        setupLevel();
    }

    // Hilfe-Toggle
    function toggleHelp() {
        handDiagram.style.display = handDiagram.style.display === 'none' ? 'block' : 'none';
    }

    // Event-Listener
    document.addEventListener('keydown', handleKeyPress);
    nextLevelBtn.addEventListener('click', nextLevel);
    restartBtn.addEventListener('click', restart);
    helpBtn.addEventListener('click', toggleHelp);

    // Spielstart
    setupLevel();
</script>
</body>
</html>